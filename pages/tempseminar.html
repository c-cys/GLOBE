<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../stylesheets/seminar.css">
    <title>세미나 자료 목록</title>
    <script src="../scripts/navbar.js"></script>
</head>
<body>
    <script>
        function submitForm() {
            var category = document.getElementById('category').value;
            window.location.href = 'seminar.php?category=' + encodeURIComponent(category);
        }

        document.addEventListener('DOMContentLoaded', function () {
            var uploadDir = '../assets/data/uploads/';
            var category = (new URLSearchParams(window.location.search)).get('category');
            var categoryDir = uploadDir + category + '/';

            if (category) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        var response = JSON.parse(this.responseText);
                        displayFiles(response);
                    }
                };
                xhttp.open("GET", categoryDir + 'descriptions.json', true);
                xhttp.send();
            }
        });

        function displayFiles(files) {
            var fileContainer = document.getElementById('file-container');
            fileContainer.innerHTML = '';
            if (files.length > 0) {
                files.forEach(function (file) {
                    if (file.endsWith('.pdf')) {
                        var fileCard = document.createElement('div');
                        fileCard.className = 'col-md-3 mb-3 d-flex';
                        var cardBody = document.createElement('div');
                        cardBody.className = 'card flex-fill file-card';
                        var embed = document.createElement('embed');
                        embed.src = categoryDir + file;
                        embed.type = 'application/pdf';
                        embed.style.height = '300px';
                        var fileDescription = document.createElement('div');
                        fileDescription.className = 'file-description mt-3 flex-grow-3';
                        fileDescription.style.fontSize = '14px';
                        fileDescription.style.height = '50px';
                        fileDescription.textContent = 'No description available.';
                        var downloadButton = document.createElement('button');
                        downloadButton.className = 'btn btn-success';
                        var downloadLink = document.createElement('a');
                        downloadLink.href = 'download.php?file=' + encodeURIComponent(file) + '&category=' + encodeURIComponent(category);
                        downloadLink.target = '_blank';
                        downloadLink.textContent = '다운로드';
                        downloadLink.className = 'text-white';
                        downloadButton.appendChild(downloadLink);
                        cardBody.appendChild(embed);
                        cardBody.appendChild(fileDescription);
                        cardBody.appendChild(downloadButton);
                        fileCard.appendChild(cardBody);
                        fileContainer.appendChild(fileCard);
                    }
                });
            } else {
                var noFilesMessage = document.createElement('p');
                noFilesMessage.className = 'col-12 no-files-message';
                noFilesMessage.textContent = 'No files to display.';
                fileContainer.appendChild(noFilesMessage);
            }
        }
    </script>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">
                <h2 class="mt-3 mb-4">세미나 자료 목록</h2>
            </div>
            <div class="col-md-6">
                <div class="mb-3 mt-3 text-md-right">
                </div>
                <form action="seminar.php" method="get" class="form-inline mb-3">
                    <div class="col-auto">
                        <label for="category" class="mr-2">카테고리 선택:</label>
                        <div class="input-group">
                            <select name="category" id="category" class="form-control mr-2"></select>
                            <button type="button" onclick="submitForm()" class="btn btn-primary">선택</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="file-container row" id="file-container"></div>
    </div>
    <script src="../scripts/pdf_size.js"></script>
</body>
</html>